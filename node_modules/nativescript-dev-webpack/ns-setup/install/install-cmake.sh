#!/bin/bash

# Installs to /usr/local!
# Assumes we have write permissions: either run by root or previously chown-ed by homebrew

CMAKE_VERSION_SHORT="3.3.2"
CMAKE_VERSION="${CMAKE_VERSION_SHORT}-1"
CMAKE_URL="https://cmake.org/files/v3.3/cmake-${CMAKE_VERSION}-src.tar.bz2"

clean() {
    rm -rf *.bz2
    rm -rf cmake-$CMAKE_VERSION_SHORT
}

download_distro() {
    curl -o cmake-src.tar.bz2 "$CMAKE_URL"
}

unpack_source() {
    tar -jxvf ./cmake-src.tar.bz2
}

install() {
    bash ./cmake-$CMAKE_VERSION.sh prep
    (cd cmake-$CMAKE_VERSION_SHORT && \
        ./bootstrap && \
        ./configure && \
        make install
        )
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]] ; then
    clean && \
        download_distro && \
        unpack_source && \
        install
fi
