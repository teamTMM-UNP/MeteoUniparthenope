#!/bin/bash

brew update
brew uninstall xcproj && true; brew install xcproj 
brew uninstall apktool && true; brew install apktool 

# Android runtime pacakges
brew install git-lfs
git lfs install

# appium
brew uninstall ios-webkit-debug-proxy && true
brew uninstall ideviceinstaller && true
brew uninstall libimobiledevice && true
brew install --HEAD libimobiledevice
brew link --overwrite libimobiledevice && true
brew install --HEAD ideviceinstaller
brew link --overwrite ideviceinstaller && true
brew install ios-webkit-debug-proxy
brew uninstall carthage && true; brew install carthage 

# nodejs
if [[  $(which node) =~ "/n/bin/" ]]; then
  # Do not reinstall nodejs it tj/n found
  echo "Found tj/n! Do NOT update node."
else
  echo "Update nodejs."
  sudo rm -rf /usr/local/{lib/node{,/.npm,_modules},bin,share/man}/{npm*,node*,man1/node*}
  sudo rm -rf '/usr/local/lib/dtrace/node.d'
  sudo rm -rf '/usr/local/etc/bash_completion.d/npm'
  sudo rm -rf '/usr/local/include/node'
  brew unlink node4-lts && true; 
  brew uninstall node && true; 
  brew uninstall node6-lts && true; 
  brew uninstall node@6 && true; 
  brew install node@6
  if [[ ! -z $(grep "node@6" ~/.bash_profile) ]]; then 
   echo "Node 6 found in ~/.bash_profile"; 
  else
    echo 'export PATH="/usr/local/opt/node@6/bin:$PATH"' >> ~/.bash_profile
    echo 'export PATH="/usr/local/opt/node@6/bin:$PATH"' >> ~/.profile
  fi
  source ~/.bash_profile
  source ~/.profile
  npm i -g -f npm@4
fi

# for ios-runtime builds
brew install automake
brew install libtool
brew install llvm
node -v
npm -v
