#!/bin/bash

# TODO: Following line fixes this issue:
# http://stackoverflow.com/questions/9132826/stop-developer-tools-access-needs-to-take-control-of-another-process-for-debugg
# sudo /usr/sbin/DevToolsSecurity --enable

dir="$(dirname "$0")"

echo "Kill emulators and simulators"
"$dir/kill-all-emulators.sh"
"$dir/kill-all-simulators.sh"

"$dir/verify-setup-osx.sh"

"$dir/clean-caches.sh"
"$dir/clean-global-workspace.sh"

# This will be executed once per 5 builds
if [[ $BUILD_NUMBER == *5 ]] || [[ $FORCE == true ]]; then
    "$dir/update-pods.sh"
    "$dir/update-android-sdk.sh"
    "$dir/update-android-emulators.sh"
    "$dir/update-brew-packages-node8.sh"
    "$dir/update-npm-packages.sh"
fi
"$dir/reset-emulators.sh"
"$dir/reset-simulators.sh"
"$dir/clean-global-workspace.sh"

"$dir/verify-setup-osx.sh"

cp "$dir/../ci/npm/tns-bot/.npmrc" ~/.npmrc
