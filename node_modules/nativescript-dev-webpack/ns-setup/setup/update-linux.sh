#!/bin/bash

dir="$(dirname "$0")"

"$dir/kill-all-emulators.sh"

ps -ef | grep appium | grep -v grep | awk '{print $2}' | xargs kill -9
ps -ef | grep tail | grep -v grep | awk '{print $2}' | xargs kill -9
ps -ef | grep node | grep -v grep | awk '{print $2}' | xargs kill -9
ps -ef | grep gradle | grep -v grep | awk '{print $2}' | xargs kill -9

if [[ $BUILD_NUMBER == *5 ]] || [[ $FORCE == true ]]; then
    "$dir/clean-global-workspace.sh"
    "$dir/update-android-sdk.sh"
    "$dir/update-android-emulators.sh"
fi

"$dir/clean-caches.sh"
"$dir/reset-emulators.sh"
"$dir/update-npm-packages.sh"

cp ./ns-setup/ci/npm/tns-bot/.npmrc ~/.npmrc
