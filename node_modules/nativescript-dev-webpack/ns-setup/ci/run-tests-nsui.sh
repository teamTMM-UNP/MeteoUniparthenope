#!/bin/bash
set -e

path=$1
config=$2

version=0.0.5
core=functional.tests.core
jar=${core}-${version}.jar

echo "Clean up workspace"
rm -rf FunctionalTests/target
rm -fr FunctionalTests/testapp
rm -fr FunctionalTests/lib

echo "Setup workspace"
mkdir -v FunctionalTests/testapp
mkdir -v FunctionalTests/lib

echo "Copying functional.tests.core from Stable ..."
cp /tns-dist/functional-tests-core/Stable/$jar ./FunctionalTests/lib/$jar

echo "Default will be used:" 
export STORAGE="${3:-/mnt/Distributions/OfficialReleases/NativeScript/functional-tests}"
echo $STORAGE

echo "Copying $1 ..."
cp /tns-dist/TestApps/$path ./FunctionalTests/testapp/

cd FunctionalTests
echo "Installing functional.tests.core ..."
mvn install:install-file -Dfile=lib/${jar} -DgroupId=${core} -DartifactId=${core} -Dversion=${version} -Dpackaging=jar

echo "Executing test configuration ..."
mvn clean test -P ${config}

