#!/bin/bash
set -e
echo "Build iOS"
if [ "$#" -eq 2 ]; then
    appDir=$1
    packageId=$appDir
    outFile=$2
else
    if [ "$#" -eq 3 ]; then
        appDir=$1
        packageId=$2
        outFile=$3
    else
        echo "Illegal number of parameters"
    fi
fi
echo "TestApp Folder: $appDir" 
echo "PackageId: $packageId" 
echo "Output File: $outFile" 

node_modules/.bin/tns build ios --release --path $appDir
tar -czf $packageId.tgz --directory=$appDir/platforms/ios/build/emulator $packageId.app
mv $packageId.tgz out/$outFile.tgz

node_modules/.bin/tns build ios --release --forDevice --path $appDir --provision $PROVISIONING
mv $appDir/platforms/ios/build/device/$packageId.ipa out/$outFile.ipa