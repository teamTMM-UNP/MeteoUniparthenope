#!/bin/bash

# Sample usage:
# ./ns-setup/ci/project-add-platform-android.sh TestApp

# Spec:
# If current folder contains release then use $ANDROID_VERSION from Sinopia
# Else use tns-android.tgz

set -e

if [ "$#" -eq 1 ]; then
    app=$1
    
    # Hack, please remove it for {N} 3.0
    if [ -f $app/app/App_Resources/Android/app.gradle ]; then
        echo "app.gradle exists!"
    else
        echo "app.gradle does not exist!"
        curl https://raw.githubusercontent.com/NativeScript/template-hello-world/master/App_Resources/Android/app.gradle --output app.gradle
        mv app.gradle $app/app/App_Resources/Android/app.gradle
    fi

    echo "Platform remove"
    node_modules/.bin/tns platform remove android --path $app && true
    echo "Platform add"
    if [[ "$PWD" == *hotfix* ]]; then
        echo "You are in hotfix branch. Will use Sinopia ..."
        node_modules/.bin/tns platform add android@$FIX_ANDROID --path $app
    elif [[ "$PWD" == *release* ]]; then
        echo "You are in release branch. Will use Sinopia ..."
        node_modules/.bin/tns platform add android@$ANDROID_VERSION --path $app
    else
        echo "You are in master branch. Will use tns-android.tgz ..."
        node_modules/.bin/tns platform add android --frameworkPath tns-android.tgz --path $app
    fi
else    
    echo "Illegal number of parameters"
    echo "Sample usage:" 
    echo "./ns-setup/ci/project-add-platform.sh TestApp"
    exit 1
fi
