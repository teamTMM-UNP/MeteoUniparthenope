#!/bin/bash
set -e

app=$1
sample=$2

echo "Cleaning up $app ... (except App_Resources)"
cd $app/app
find . ! -name 'App_Resources' -type d -maxdepth 1 -exec rm -rf {} + || true
rm -rf *.* || true
cd ../..

if [ $sample = "cuteness" ]; then

    echo "Extracting tns-samples-apps.tgz ..."
    tar -xvf ./tns-samples-apps.tgz

    echo "Copying cuteness.io ..."
    cp -R package/cuteness.io $app/app/
    touch $app/app/package.json
    echo "{ \"name\": \"cuteness-io\" }" >> $app/app/package.json
    touch $app/app/index.js
    echo "require(\"./cuteness.io/app\");" >> $app/app/index.js
    rm -rf package
    
elif [ $sample = "gallery" ]; then

    echo "Extracting tns-samples-apps.tgz ..."
    tar -xvf ./tns-samples-apps.tgz

    echo "Copying gallery-app ..."
    cp -R package/gallery-app $app/app/
    touch $app/app/package.json
    echo "{ \"name\": \"gallery-app\" }" >> $app/app/package.json
    touch $app/app/index.js
    echo "require(\"./gallery-app/app\");" >> $app/app/index.js
    rm -rf package

elif [ $sample = "uitests" ]; then

    echo "Extracting tns-samples-apps.tgz ..."
    tar -xvf ./tns-samples-apps.tgz

    echo "Copying ui-tests-app ..."
    cp -R package/ui-tests-app $app/app/
    touch $app/app/package.json
    echo "{ \"name\": \"ui-tests-app\" }" >> $app/app/package.json
    touch $app/app/index.js
    echo "require(\"./ui-tests-app/app\");" >> $app/app/index.js
    rm -rf package
    
elif [ $sample = "perfapp" ]; then

    echo "Extracting tns-samples-apps.tgz ..."
    tar -xvf ./tns-samples-apps.tgz

    echo "Copying perf-app ..."
    cp -R package/perf-app $app/app/
    touch $app/app/package.json
    echo "{ \"name\": \"perf-app\" }" >> $app/app/package.json
    touch $app/app/index.js
    echo "require(\"./perf-app/app\");" >> $app/app/index.js
    rm -rf package   

else

    echo "Extracting $sample ..."
    tar -xvf $sample
    # We count on App_Resources from the repo
    # https://github.com/NativeScript/NativeScript/tree/master/tests/app/App_Resources
    # before:
    # rm -rf package/App_Resources || true
    # after:
    rm -rf $app/app/App_Resources
    mv package/* $app/app/
    rm -rf package

fi
