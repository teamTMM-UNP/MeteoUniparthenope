#!/bin/bash
set -e

path=$1
config=$2

version=0.0.5
core=functional.tests.core
jar=$core-$version.jar

echo "Set env variables"
if [ "$#" -eq 3 ]; then
    storage=$3
	echo "STORAGE specified."
    export STORAGE=$storage
    echo $STORAGE
else
    echo "Storage not specified. Stable storage will be used:"
    export STORAGE=/mnt/Distributions/DailyBuilds/NativeScript/functional-tests/Stable
    echo $STORAGE
fi

echo "Clean up workspace"
rm -fr testapp
rm -fr lib

echo "Setup workspace"
mkdir -v testapp
mkdir -v lib

echo "Copying $1 ..."
cp /tns-dist/TestApps/$path ./testapp/

echo "Copying functional.tests.core ..."
cp /tns-dist/functional-tests-core/Stable/$jar ./lib/$jar

echo "Installing functional.tests.core ..."
mvn install:install-file -Dfile=lib/$jar -DgroupId=$core -DartifactId=$core -Dversion=$version -Dpackaging=jar

echo "Executing test configuration ..."
mvn clean test -P $config
