#!/bin/bash
set -e

path=$1
config=$2
branch=$3

echo "Change branch"
echo $branch
git checkout $branch | true
git status

echo "Clean up workspace"
rm -rf testapp
rm -rf lib
rm -rf functional-tests-core

echo "Setup workspace"
mkdir -v testapp
mkdir -v lib

echo "Copying $1 ..."
cp /tns-dist/TestApps/$path ./testapp/

echo "Clone functional.tests.core ..."
git clone git@github.com:NativeScript/functional-tests-core.git

echo "Cd in functional-tests-core"
cd functional-tests-core/

echo "Change branch"
git checkout $branch | true
git status

echo "Build"
./build.sh
 
cd ../

echo "Copying functional.tests.core ..."
cp ./functional-tests-core/target/functional.tests.core-0.0.4.jar ./lib/functional.tests.core-0.0.4.jar

echo "Installing functional.tests.core ..."
mvn install:install-file -Dfile=lib/functional.tests.core-0.0.4.jar -DgroupId=functional.tests.core -DartifactId=functional.tests.core -Dversion=0.0.4 -Dpackaging=jar


echo "Executing test configuration ..."
mvn clean test -P $config

rm -rf functional-tests-core
echo "Cleaned up functional-tests-core"

