#!/bin/bash
set -e

path=$1
config=$2

version=0.0.5
core=functional.tests.core
jar=${core}-${version}.jar

branch="Stable"

echo "Clean up workspace"
rm -fr testapp
rm -fr lib

echo "Setup workspace"
mkdir -v testapp
mkdir -v lib

if [[ "$PWD" == *hotfix* ]]; then
    branch="Release"
elif [[ "$PWD" == *release* ]]; then
    branch="Release"
fi

echo "Copying functional.tests.core from ${branch} ..."
cp /tns-dist/functional-tests-core/${branch}/${jar} ./lib/

export STORAGE="${3:-/mnt/Distributions/OfficialReleases/NativeScript/functional-tests/${branch}}"
echo "Storage: ${3:-/mnt/Distributions/OfficialReleases/NativeScript/functional-tests/${branch}}"

echo "Copying $1 ..."
cp /tns-dist/TestApps/${path} ./testapp/

echo "Installing functional.tests.core ..."
mvn install:install-file -Dfile=lib/${jar} -DgroupId=${core} -DartifactId=${core} -Dversion=${version} -Dpackaging=jar -DpomFile=pom.xml

echo "Executing test configuration ..."
mvn clean test -P ${config}
