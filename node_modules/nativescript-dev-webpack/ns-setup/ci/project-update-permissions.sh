#!/bin/bash
set -e

app=$1
infoPlistFile="$app/app/App_Resources/iOS/Info.plist"
manifestFile="$app/app/App_Resources/Android/src/main/AndroidManifest.xml"
manifestFileTemp="$app/app/App_Resources/Android/src/main/AndroidManifest.xml.tmp"

echo "Update AndroidManifest.xml"
sed 's/.*android.permission.INTERNET.*/<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"\/>&/' $manifestFile > $manifestFileTemp
rm -rf $manifestFile
cp $manifestFileTemp $manifestFile
rm -rf $manifestFileTemp
sed 's/.*android.permission.INTERNET.*/<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"\/>&/' $manifestFile > $manifestFileTemp
rm -rf $manifestFile
cp $manifestFileTemp $manifestFile
rm -rf $manifestFileTemp

echo "Update Info.plist"
sed -i -e '/^<\/dict>/i \
<key>NSAppTransportSecurity<\/key>\
<dict>\
<key>NSAllowsArbitraryLoads<\/key>\
<true\/>\
<\/dict>\
' $infoPlistFile